# Git Hooks 配置说明

## 已配置的Hooks

### 1. pre-commit hook
在每次 `git commit` 之前运行，执行以下检查：

#### ✅ Python 语法检查
- 检查所有暂存的 `.py` 文件的语法
- 使用多种Python解释器和方法确保兼容性
- 如果Python环境有问题，会给出警告但不会阻止提交

#### ✅ 代码风格检查
- 检查尾随空白字符
- 检查行长度是否超过120字符
- 提醒添加函数和类的文档字符串

#### ✅ JSON 语法检查
- 验证所有暂存的 `.json` 文件的有效性

#### ✅ Markdown 文件检查
- 检查尾随空白字符
- 检查连续空行

### 2. pre-push hook
在每次 `git push` 之前运行，执行关键检查：

#### ✅ 关键语法检查
- 检查仓库中所有Python文件的语法（不仅仅是暂存的文件）
- 排除 `.git/`, `python_portable/`, `__pycache__/` 目录

#### ✅ 配置文件检查
- 验证配置文件（JSON, YAML等）的语法

#### ✅ 安全检查
- 检查是否意外提交了API密钥、密码等敏感信息
- 排除API指南文件

## 使用方法

### 正常提交流程
```bash
git add <files>
git commit -m "Commit message"
# pre-commit hook 会自动运行
```

### 如果需要跳过hooks
```bash
# 跳过 pre-commit hook
git commit --no-verify -m "Commit message"

# 跳过 pre-push hook
git push --no-verify
```

### Hook输出示例
```
🔍 Running pre-commit checks...
📝 Checking Python syntax...
  Checking example.py...
  ✅ example.py syntax OK
🎨 Checking Python code style...
  ✅ example.py style check completed
📋 Checking JSON syntax...
📖 Checking Markdown files...

📊 Pre-commit check summary:
  Python syntax errors: 0
  Python style issues: 0
  JSON syntax errors: 0
  Markdown issues: 0
  Total issues: 0

✅ All pre-commit checks passed!
```

## 配置自定义

### 修改检查规则
编辑以下文件：
- `.git/hooks/pre-commit` - 提交前检查
- `.git/hooks/pre-push` - 推送前检查

### 禁用特定检查
在相应的hook文件中注释掉不需要的检查部分。

### 添加新的检查
可以在hook文件中添加新的检查逻辑。

## 故障排除

### Python环境问题
如果Python语法检查失败，hook会尝试多种方法：
1. `python3 -c "import ast; ast.parse(open(file).read())"`
2. `python -m py_compile file`
3. `python -c "import ast; ast.parse(open(file).read())"`

如果都失败，会显示警告但不会阻止提交。

### 权限问题
确保hook文件有执行权限：
```bash
chmod +x .git/hooks/pre-commit
chmod +x .git/hooks/pre-push
```

## 最佳实践

1. **保持hooks简单**：只检查最重要的内容
2. **快速执行**：hooks应该快速运行，不影响开发效率
3. **友好提示**：提供清晰的错误信息和修复建议
4. **允许绕过**：在紧急情况下提供绕过机制
5. **定期更新**：根据项目需求更新检查规则

## 项目特定配置

当前项目的hook配置：
- **最大行长度**：120字符
- **排除目录**：`.git/`, `python_portable/`, `__pycache__/`
- **安全检查**：检查API密钥模式（排除API指南文件）
- **文档提醒**：提醒添加函数和类的docstrings